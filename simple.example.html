<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="src/selectors.js" type="text/javascript" charset="utf-8"></script>
  <script src="src/jquery.selectors.js" type="text/javascript" charset="utf-8"></script>
  <style type="text/css" media="screen">
    body > * {
      margin-bottom: 2em;
    }
    body > .todo_list{
      padding: 0.5em;
      background: #B9CFED;
      border: 1px solid #96A8C0;
    }
    body > .todo_list > ul > li{
      width: 300px;
      clear: both;
      border-bottom: 1px solid grey;
    }
    body > .todo_list > ul > li > h3{
      float: left;
      display: inline;
      margin: 0;
    }
    body > .todo_list > ul > li > a{
      float: right;
    }
  </style>
  <script type="text/javascript" charset="utf-8">

    S('body')
      .def('new_todo_list_button', '> input[value="new todo list"]').end
      .def('todo_list', '> .todo_list')
        .def('new_value', '> input[type="text"]').end
        .def('add_button', '> input[type="button"]').end
        .def('list', '> ul')
          .def('item', '> li')
            .def('name', '> h3').end
            .def('close', '> a').end
          .end
        .end
      .end
    .end;

    /*
    html                                    html
    html body                               html body
    html body new_todo_list_button          html body > input[value="new todo list"]
    html body todo_list                     html body > .todo_list
    html body todo_list new_value           html body > .todo_list > input[type="text"]
    html body todo_list add_button          html body > .todo_list > input[type="button"]
    html body todo_list list                html body > .todo_list > ul
    html body todo_list list item           html body > .todo_list > ul > li
    html body todo_list list item name      html body > .todo_list > ul > li > h3
    html body todo_list list item close     html body > .todo_list > ul > li > a
    html head                               html head
    */

    S('new_todo_list_button').click(function(){
      $('body').append(
        '<div class="todo_list">'+
          '<input type="text"/><input type="button" value="add" />'+
          '<ul></ul>'+
        '</div>'
      );
    });

    S('todo_list').bind('add_item', function(event){
      var new_value = this.down('new_value'),
          value = new_value.val();

      if (value) this.down('list').append(
        '<li>'+
          '<h3>'+value+'</h3>'+
          '<a href="#">X</a>'+
        '</li>'
      );

      new_value.val('').focus();
    });

    S('todo_list new_value').bind('keyup', function(event){
      if (event.which === 13){
        this.up('todo_list').down('add_button').click();
        return false;
      }
    });

    S('todo_list add_button').click(function(){
      this.up('todo_list').trigger('add_item', false);
    });

    S('todo_list list item close').click(function(event){
      event.preventDefault();
      this.up('item').remove();
    });

  </script>
</head>
<body>
  <input type="button" value="new todo list"></input>
</body>
</html>
